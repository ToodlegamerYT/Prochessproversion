<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chess</title>
<style>
body{background:#121212;color:white;text-align:center;font-family:Arial;}
.dark{background:#121212;color:white;} .light{background:white;color:black;}
#board{width:480px;height:480px;margin:auto;display:grid;grid-template-columns:repeat(8,1fr);} 
.square{width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:40px;cursor:grab;}
.white{background:#f0d9b5;} .black{background:#b58863;}
.modern .white{background:#ccc;} .modern .black{background:#666;}
button,select{padding:8px;margin:5px;}
</style>
</head>
<body class="dark">
<h1>Game: Chess</h1>
<div>
AI:
<select id="aiLevel"><option value="1">Easy</option><option value="2">Medium</option><option value="3">Hard</option></select>
Timer:
<select id="timer"><option value="0">No Timer</option><option value="300">5 Min</option><option value="600">10 Min</option><option value="1800">30 Min</option></select>
Skin:
<select id="skin"><option value="classic">Classic</option><option value="modern">Modern</option></select>
<button onclick="start()">Start</button>
<button onclick="undo()">Undo</button>
<button onclick="toggleDark()">Dark Mode</button>
<button onclick="saveGame()">Save</button>
<button onclick="loadGame()">Load</button>
<button onclick="toggleSound()">Sound</button>
<h3 id="elo">ELO:1200</h3>
<h3 id="wt"></h3><h3 id="bt"></h3>
</div>
<div id="board"></div>
<h3>Moves</h3><div id="history"></div>
<script>
const sound=new Audio("https://www.soundjay.com/buttons/sounds/button-16.mp3");
let soundOn=true, elo=1200, turn="white", history=[], timers={white:0,black:0}, interval;
let enPassant=null, castle={K:true,Q:true,k:true,q:true};
const classic={r:"â™œ",n:"â™ž",b:"â™",q:"â™›",k:"â™š",p:"â™Ÿ",R:"â™–",N:"â™˜",B:"â™—",Q:"â™•",K:"â™”",P:"â™™"};
const modern={r:"ðŸŸ¥",n:"ðŸŸ§",b:"ðŸŸ¨",q:"ðŸŸ©",k:"ðŸŸ¦",p:"ðŸŸª",R:"ðŸ”´",N:"ðŸŸ ",B:"ðŸŸ¡",Q:"ðŸŸ¢",K:"ðŸ”µ",P:"ðŸŸ£"};
let pieces=classic, board=[], selected=null;
function start(){pieces=document.getElementById("skin").value==="modern"?modern:classic; board=[["r","n","b","q","k","b","n","r"],["p","p","p","p","p","p","p","p"],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["P","P","P","P","P","P","P","P"],["R","N","B","Q","K","B","N","R"]]; turn="white"; history=[]; enPassant=null; castle={K:true,Q:true,k:true,q:true}; document.getElementById("history").innerHTML=""; let t=parseInt(document.getElementById("timer").value); timers.white=timers.black=t; clearInterval(interval); if(t>0) interval=setInterval(updateTimer,1000); draw();}
function updateTimer(){timers[turn]--; document.getElementById("wt").innerText="White: "+timers.white; document.getElementById("bt").innerText="Black: "+timers.black; if(timers[turn]<=0){alert(turn+" lost on time!"); clearInterval(interval);}}
function draw(){const bd=document.getElementById("board"); bd.className=document.getElementById("skin").value; bd.innerHTML=""; for(let y=0;y<8;y++){for(let x=0;x<8;x++){let sq=document.createElement("div"); sq.className="square "+((x+y)%2?"black":"white"); sq.draggable=true; sq.ondragstart=()=>selected={x,y}; sq.ondrop=e=>{e.preventDefault(); move(selected.x,selected.y,x,y);}; sq.ondragover=e=>e.preventDefault(); sq.innerHTML=pieces[board[y][x]]||""; bd.appendChild(sq);}}}
function inBounds(x,y){return x>=0&&x<8&&y>=0&&y<8;}
function clone(b){return JSON.parse(JSON.stringify(b));}
function isWhite(p){return p&&p===p.toUpperCase();}
function kingPos(b,t){for(let y=0;y<8;y++)for(let x=0;x<8;x++)if(b[y][x]===(t==="white"?"K":"k"))return{x,y};}
function attacks(b,x,y,tx,ty){let p=b[y][x]; if(!p) return false; let d=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]]; if(p.toLowerCase()==='q'||p.toLowerCase()==='r'||p.toLowerCase()==='b'){for(let [dx,dy] of d){for(let i=1;i<8;i++){let nx=x+dx*i,ny=y+dy*i; if(!inBounds(nx,ny)) break; if(nx===tx&&ny===ty) return true; if(b[ny][nx]) break;}}}
if(p.toLowerCase()==='n'){for(let [dx,dy] of [[1,2],[2,1],[-1,2],[-2,1],[1,-2],[2,-1],[-1,-2],[-2,-1]]) if(x+dx===tx&&y+dy===ty) return true;}
if(p.toLowerCase()==='k'){for(let dx=-1;dx<=1;dx++)for(let dy=-1;dy<=1;dy++) if(x+dx===tx&&y+dy===ty) return true;}
if(p==='P'){if(tx===x-1&&ty===y-1||tx===x+1&&ty===y-1) return true;} if(p==='p'){if(tx===x-1&&ty===y+1||tx===x+1&&ty===y+1) return true;}
return false;}
function inCheck(b,t){let k=kingPos(b,t); for(let y=0;y<8;y++)for(let x=0;x<8;x++) if(b[y][x]&&((t==='white')!==isWhite(b[y][x]))) if(attacks(b,x,y,k.x,k.y)) return true; return false;}
function legal(x1,y1,x2,y2){let b=clone(board); let p=b[y1][x1]; if(!p) return false; if(turn==='white'!==isWhite(p)) return false; b[y2][x2]=p; b[y1][x1]=''; return !inCheck(b,turn);} 
function move(x1,y1,x2,y2){if(!legal(x1,y1,x2,y2)) return; let p=board[y1][x1]; history.push(JSON.stringify(board)); board[y2][x2]=p; board[y1][x1]=''; if(soundOn) sound.play(); if((p==='P'&&y2===0)||(p==='p'&&y2===7)) board[y2][x2]=p==='P'?'Q':'q'; turn=turn==='white'?'black':'white'; document.getElementById('history').innerHTML+='Move '+history.length+'<br>'; draw(); if(checkmate(turn)){alert('Checkmate!'); elo+=turn==='white'?-10:10; document.getElementById('elo').innerText='ELO:'+elo;} if(turn==='black') setTimeout(aiMove,300);} 
function checkmate(t){if(!inCheck(board,t)) return false; for(let y=0;y<8;y++)for(let x=0;x<8;x++)for(let yy=0;yy<8;yy++)for(let xx=0;xx<8;xx++){let b=clone(board); if(b[y][x]&&((t==='white')===isWhite(b[y][x]))){b[yy][xx]=b[y][x]; b[y][x]=''; if(!inCheck(b,t)) return false;}} return true;}
function aiMove(){let best=null; for(let y=0;y<8;y++)for(let x=0;x<8;x++) if(board[y][x]&&board[y][x]===board[y][x].toLowerCase()) for(let yy=0;yy<8;yy++)for(let xx=0;xx<8;xx++) if(legal(x,y,xx,yy)) best={x1:x,y1:y,x2:xx,y2:yy}; if(best) move(best.x1,best.y1,best.x2,best.y2);} 
function undo(){if(history.length){board=JSON.parse(history.pop()); turn=turn==='white'?'black':'white'; draw();}}
function toggleDark(){document.body.classList.toggle('light'); document.body.classList.toggle('dark');}
function saveGame(){localStorage.setItem('chessSave',JSON.stringify({board,turn,elo})); alert('Game Saved');}
function loadGame(){let d=JSON.parse(localStorage.getItem('chessSave')); if(d){board=d.board; turn=d.turn; elo=d.elo; document.getElementById('elo').innerText='ELO:'+elo; draw();}}
function toggleSound(){soundOn=!soundOn; alert('Sound '+(soundOn?'On':'Off'));}
start();
</script>
</body>
</html>
